(()=>{"use strict";const e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-30",headers:{authorization:"ef6f4971-986f-4940-9ee3-c61b74980adb","Content-Type":"application/json"}},t=e=>e.ok?e.json():Promise.reject(`Ошибка ${e.status}`);function r(e,t,r,o,n,c,a,s,l){const u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__image"),p=u.querySelector(".card__like-count");i.setAttribute("src",r),i.setAttribute("alt",t),u.querySelector(".card__title").textContent=t,p.textContent=n.length;const d=u.querySelector(".card__delete-button");i.addEventListener("click",(()=>{a(r,t)}));const _=u.querySelector(".card__like-button");return _.addEventListener("click",(()=>{c(_,e,p)})),n.some((e=>e._id===l))&&_.classList.add("card__like-button_is-active"),s!==l?(console.log("Removing delete button"),d.remove()):d.addEventListener("click",(()=>{o(u,e)})),u}function o(r,o,n){((r,o)=>fetch(`${e.baseUrl}/cards/likes/${r}`,{method:o?"DELETE":"PUT",headers:e.headers}).then(t))(o,r.classList.contains("card__like-button_is-active")).then((e=>{r.classList.toggle("card__like-button_is-active"),n.textContent=e.likes.length})).catch((e=>console.log(e)))}function n(r,o){(r=>fetch(`${e.baseUrl}/cards/${r}`,{method:"DELETE",headers:e.headers}).then(t))(o).then((()=>{r.remove()})).catch((e=>{console.log(`Ошибка во время удаления карточки: ${e}`)}))}const c={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},a=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach((r=>s(e,r,t))),l(r,o,t)},s=(e,t,r)=>{const o=e.querySelector(`.${t.id}-error`);o?(t.classList.remove(r.inputErrorClass),t.setCustomValidity(""),o.classList.remove(r.errorClass),o.textContent=""):console.error(`Элемент с ошибкой для ${t.id} не найден`)},l=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(r.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))};function u(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",p),e.addEventListener("click",d)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",p),e.removeEventListener("click",d)}function p(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");e&&i(e)}}function d(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close"))&&i(e.currentTarget)}const _=document.querySelector(".places__list"),m=document.querySelectorAll(".popup__close"),y=document.querySelector(".popup_type_new-card"),v=document.querySelector('.popup__form[name="new-place"]'),f=v.querySelector(".popup__input_type_card-name"),h=v.querySelector(".popup__input_type_url"),S=document.querySelector(".profile__add-button"),b=document.querySelector(".popup_type_edit"),q=document.querySelector('.popup__form[name="edit-profile"]'),E=q.querySelector(".popup__input_type_name"),L=q.querySelector(".popup__input_type_description"),C=document.querySelector(".profile__info"),k=C.querySelector(".profile__title"),g=C.querySelector(".profile__description"),x=C.querySelector(".profile__edit-button"),$=document.querySelector(".popup_type_avatar"),A=document.querySelector('.popup__form[name="edit-avatar"]'),T=document.querySelector(".popup__input_type_avatar"),U=document.querySelector(".profile__image"),w=document.querySelector(".popup_type_image"),B=w.querySelector(".popup__image"),D=w.querySelector(".popup__caption");let P=null;function j(e,t){B.src=e,B.alt=t,D.textContent=t,u(w)}function N(e,t){t?_.prepend(e):_.append(e)}const H=(e,t)=>{const r=t.querySelector(".popup__button");e?(r.setAttribute("data-text",r.textContent),r.textContent="Сохранение..."):(r.textContent=r.getAttribute("data-text"),r.removeAttribute("data-text"))};x.addEventListener("click",(()=>{E.value=k.textContent,L.value=g.textContent,a(q,c),u(b)})),S.addEventListener("click",(()=>{v.reset(),a(v,c),u(y)})),U.addEventListener("click",(()=>{A.reset(),a(A,c),u($)})),m.forEach((e=>{const t=e.closest(".popup");e.addEventListener("click",(()=>{t&&i(t)}))})),q.addEventListener("submit",(function(r){var o,n;r.preventDefault(),H(!0,q),(o=E.value,n=L.value,fetch(`${e.baseUrl}/users/me`,{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:n})}).then(t)).then((e=>{k.textContent=e.name,g.textContent=e.about,i(b)})).catch(console.error).finally((()=>H(!1,q)))})),v.addEventListener("submit",(function(e){e.preventDefault(),H(!0,v),r(f.value,h.value).then((e=>{N(r(e._id,f.value,h.value,n,e.likes,o,j,e.owner._id,P),!0),v.reset(),i(y)})).catch(console.error).finally((()=>H(!1,v)))})),A.addEventListener("submit",(function(r){var o;r.preventDefault(),H(!0,A),(o=T.value,fetch(`${e.baseUrl}/users/me/avatar`,{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(t)).then((({avatar:e})=>{U.style.backgroundImage=`url(${e})`,A.reset(),i($)})).catch(console.error).finally((()=>H(!1,A)))})),Promise.all([fetch(`${e.baseUrl}/users/me`,{headers:e.headers}).then(t),fetch(`${e.baseUrl}/cards`,{headers:e.headers}).then(t)]).then((([e,t])=>{P=e._id,k.textContent=e.name,g.textContent=e.about,U.style.backgroundImage=`url(${e.avatar})`,t.forEach((e=>{N(r(e._id,e.name,e.link,n,e.likes,o,j,e.owner._id,P))}))})).catch(console.error),(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);l(r,o,t),r.forEach((n=>{n.addEventListener("input",(()=>{((e,t,r)=>{t.validity.valid?s(e,t,r):((e,t,r,o)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)})(e,t,t.validationMessage,r)})(e,n,t),l(r,o,t)}))}))})(t,e)))})(c)})();